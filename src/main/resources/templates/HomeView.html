<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/PageLayout :: head('Home')}">
    <title>Home</title>
</head>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<body>
<div th:replace="~{fragments/PageLayout :: header}"></div>

<main class="body-content">
    <div class="hero-section">
        <h2>üåä Welcome to DiveFinder</h2>
        <p>Explore dive sites around the world and get inspired for your next underwater adventure!</p>
    </div>
    
    <div class="map-wrapper">
        <div id="map" class="map-container">
            <script>
                const map = L.map('map').setView([42.7, 25.4], 7); // center on Bulgaria

                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 19,
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(map);
            </script>
        </div>
    </div>
</main>

<div th:replace="~{fragments/PageLayout :: footer}"></div>

<script>
    fetch('/api/v1/sites')
        .then(response => response.json())
        .then(sites => {
            sites.forEach(site => {
                L.marker([site.latitude, site.longitude])
                    .addTo(map)
                    .bindPopup(`
                    <b>${site.siteName}</b><br>
                    ${site.description}<br><br>
                    <a href="/sites/${site.id}" class="popup-link">üîç Explore Site</a>
                `);
            });
        })
        .catch(err => console.error(err));
</script>
</body>
</html>