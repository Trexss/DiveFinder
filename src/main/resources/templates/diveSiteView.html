<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/PageLayout.html :: head('Dive Site')}"></head>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<style>
/* Page-specific layout that keeps the map to the right of the description */
.dive-details-layout-single {
    display: flex;
    flex-wrap: nowrap;
    gap: 30px;
    align-items: stretch;
}
.dive-details-layout-single .dive-details-text {
    flex: 1 1 55%;
    text-align: left;
}
.dive-details-layout-single .dive-details-map {
    flex: 1 1 45%;
    display: flex;
    justify-content: flex-end;
}
.dive-details-layout-single .dive-details-map .map-container {
    width: 100%;
    max-width: 900px;
    height: 450px;
}
@media (max-width: 900px) {
    .dive-details-layout-single {
        flex-direction: column;
    }
    .dive-details-layout-single .dive-details-map {
        justify-content: center;
    }
}
</style>

<body>

<div th:replace="~{fragments/PageLayout.html :: header}"></div>

<div class="body-content">

    <h2 th:text="#{diveSite.title}">Dive Site</h2>

    <div class="dive-details-layout dive-details-layout-single">

        <!-- LEFT SIDE: TEXT -->
        <div class="dive-details-text">
            <p class="margin12">
                <b th:text="#{diveSite.siteName} + ': '"></b>
                <span th:text="${diveSite.siteName}"></span>
            </p>
            <p class="margin12">
                <b th:text="#{diveSite.maxDepth} + ': '"></b>
                <span th:text="${diveSite.maxDepth}"></span>
            </p>

            <p class="margin12">
                <b th:text="#{diveSite.siteDescription} + ': '"></b>
                <span th:text="${diveSite.description}"></span>
            </p>
        </div>

        <!-- RIGHT SIDE: MAP -->
        <div class="dive-details-map">
            <div id="map" class="map-container"></div>
        </div>

    </div>
    <div id="comment-input" th:if="${session.currentUser != null}">
        <h3 th:text="#{comments.title}">Add a comment</h3>
        <form th:action="@{/sites/{id}/comment(id=${diveSite.id})}" th:object="${comment}" method="post">
            <label>
                <textarea th:field="*{commentText}" placeholder="Enter your comment here" rows="4" cols="50"></textarea>
            </label>
            <br>
            <label class="label-error" th:if="${#fields.hasErrors('commentText')}" th:errors="*{commentText}">Error placeholder</label>
            <br>
            <input type="submit" th:value="#{comments.submit}"/>
        </form>
    </div>
    <div th:if="${diveSite.comments.isEmpty()}">
        <p th:text="#{comments.empty}">No comments yet</p>
    </div>
    <div th:unless="${diveSite.comments.isEmpty()}">
        <div class="comment" th:each="comment : ${diveSite.comments}">
            <p class="comment-content" th:text="${comment.commentText}">Comment content here</p>
            <p class="comment-meta">
                <span th:text="#{comment.user} + ' ' + ${comment.user.firstName}">By username</span>
                <span> | </span>
                <span th:text="#{comment.created-at} + ' ' + ${#temporals.format(comment.dateCreated, 'yyyy-MM-dd')}">Posted on date</span>
            </p>
            <hr>
        </div>
    </div>


    <!-- Map initialization -->
    <script th:inline="javascript">
        /*<![CDATA[*/

        const lat = /*[[${diveSite.latitude}]]*/ 0;
        const lon = /*[[${diveSite.longitude}]]*/ 0;
        const name = /*[[${diveSite.siteName}]]*/ 'Unknown site';
        const desc = /*[[${diveSite.description}]]*/ '';

        const map = L.map('map').setView([lat, lon], 11);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19
        }).addTo(map);

        L.marker([lat, lon])
            .addTo(map)
            .bindPopup(`<b>${name}</b><br>${desc}`);

        /*]]>*/
    </script>

</div>

<div th:replace="~{fragments/PageLayout.html :: footer}"></div>

</body>
</html>