<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/PageLayout.html :: head('Dive Site')}"></head>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<body>

<div th:replace="~{fragments/PageLayout.html :: header}"></div>

<div class="body-content">

    <h2>ğŸ¤¿ <span th:text="${diveSite.siteName}">Dive Site</span></h2>

    <div class="dive-details-layout dive-details-layout-single">

        <!-- LEFT SIDE: TEXT -->
        <div class="dive-details-text">
            <h3 class="detail-heading">ğŸ“‹ Site Details</h3>
            
            <p class="margin12">
                <b class="detail-label">Site Name:</b><br>
                <span th:text="${diveSite.siteName}" class="detail-value"></span>
            </p>

            <p class="margin12">
                <b class="detail-label">Description:</b><br>
                <span th:text="${diveSite.description}" class="detail-description"></span>
            </p>
            
            <p class="margin12">
                <b class="coordinates-label">ğŸ“ Coordinates:</b><br>
                <span th:text="${diveSite.latitude}"></span>, <span th:text="${diveSite.longitude}"></span>
            </p>
        </div>

        <!-- RIGHT SIDE: MAP -->
        <div class="dive-details-map">
            <div id="map" class="map-container"></div>
        </div>

    </div>
    
    <!-- Comments Section -->
    <div class="comments-section">
        <h3 class="section-heading">ğŸ’¬ Comments &amp; Reviews</h3>
        
        <!-- Comment Input Form -->
        <div id="comment-input" th:if="${session.currentUser != null}">
            <h4 th:text="#{comments.title}" class="section-subheading">Share Your Experience</h4>
            <form th:action="@{/sites/{id}/comment(id=${diveSite.id})}" th:object="${comment}" method="post">
                <div class="form-group">
                    <input type="text" th:field="*{commentText}" placeholder="Share your diving experience at this site..."/>
                    <span class="label-error" th:if="${#fields.hasErrors('commentText')}" th:errors="*{commentText}"></span>
                </div>
                <input type="submit" th:value="#{comments.submit}"/>
            </form>
        </div>
        
        <!-- No Comments Message -->
        <div th:if="${diveSite.comments.isEmpty()}" class="card text-center">
            <p class="cta-text">
                ğŸ  <span th:text="#{comments.empty}">No comments yet. Be the first to share your experience!</span>
            </p>
        </div>
        
        <!-- Comments List -->
        <div th:unless="${diveSite.comments.isEmpty()}">
            <div class="comment" th:each="comment : ${diveSite.comments}">
                <p class="comment-content" th:text="${comment.commentText}">Comment content here</p>
                <p class="comment-meta">
                    <span>ğŸ‘¤ <span th:text="#{comment.user} + ' ' + ${comment.user.firstName}">By username</span></span>
                    <span style="margin: 0 8px;">|</span>
                    <span>ğŸ“… <span th:text="#{comment.created-at} + ' ' + ${#temporals.format(comment.dateCreated, 'yyyy-MM-dd')}">Posted on date</span></span>
                </p>
            </div>
        </div>
    </div>

    <!-- Map initialization -->
    <script th:inline="javascript">
        /*<![CDATA[*/

        const lat = /*[[${diveSite.latitude}]]*/ 0;
        const lon = /*[[${diveSite.longitude}]]*/ 0;
        const name = /*[[${diveSite.siteName}]]*/ 'Unknown site';
        const desc = /*[[${diveSite.description}]]*/ '';

        const map = L.map('map').setView([lat, lon], 11);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        L.marker([lat, lon])
            .addTo(map)
            .bindPopup(`<b>ğŸ¤¿ ${name}</b><br>${desc}`);

        /*]]>*/
    </script>

</div>

<div th:replace="~{fragments/PageLayout.html :: footer}"></div>

</body>
</html>